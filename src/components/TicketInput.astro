---
/**
 * @fileoverview Componente TicketInput para autenticaci贸n portal hotspot.
 * Proporciona validaci贸n de entrada, autenticaci贸n CHAP y redirecci贸n segura.
 */

import LoadingOverlay from "./LoadingOverlay.astro";
---

<script>
  import { initTicketHandler } from "../utils/ticketHandler";

  /**
   * Inicializa el manejador de entrada de tickets cuando el DOM est茅 listo.
   * Usa valores por defecto: m铆nimo 4 caracteres, retardo de 3 segundos.
   */
  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", () => {
      initTicketHandler({ minLength: 4, delayMs: 3000 });
    });
  } else {
    initTicketHandler({ minLength: 4, delayMs: 3000 });
  }
</script>

<div
  class="group mb-1 w-full"
  data-chap-challenge="$(chap-challenge)"
  data-link-login-only="$(link-login-only)"
  data-link-orig="$(link-orig)"
  data-chap-id="$(chap-id)"
  data-error="$(error)"
>
  <div
    class="relative overflow-hidden rounded-lg transition-all duration-300 focus-within:shadow-lg"
    style="background: linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-secondary) 100%); border: 1.5px solid var(--primary-200); box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08), inset 0 0 0 1px rgba(16, 185, 129, 0.05);"
  >
    <!-- Gradient border glow on focus -->
    <div
      class="absolute inset-0 rounded-lg opacity-0 transition-opacity duration-300 group-focus-within:opacity-100 pointer-events-none"
      style="background: linear-gradient(135deg, var(--primary-500), var(--primary-300)); padding: 1.5px;"
    >
      <div
        class="absolute inset-px rounded-lg"
        style="background-color: var(--bg-secondary);"
      >
      </div>
    </div>

    <!-- Animated background shine -->
    <div
      class="absolute inset-0 opacity-0 transition-opacity duration-300 group-focus-within:opacity-20 pointer-events-none"
      style="background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent); animation: shimmer 2s infinite;"
    >
    </div>

    <!-- Content -->
    <div class="relative flex items-center gap-2 px-3 py-2.5">
      <!-- Icon -->
      <svg
        xmlns="http://www.w3.org/2000/svg"
        fill="none"
        viewBox="0 0 24 24"
        stroke-width="2"
        stroke="currentColor"
        class="h-4 w-4 transition-all duration-300 group-focus-within:scale-110"
        style="color: var(--primary-500);"
      >
        <path stroke-linecap="round" stroke-linejoin="round" d="M12 6v12m6-6H6"
        ></path>
      </svg>

      <!-- Input -->
      <input
        type="text"
        placeholder="Ticket o PIN"
        class="flex-1 bg-transparent text-sm font-medium outline-none transition-colors"
        style="color: var(--text);"
      />

      <!-- Submit Button -->
      <button
        id="submit-btn"
        class="flex h-8 w-8 items-center justify-center rounded-lg transition-all duration-300 relative"
        style="background: linear-gradient(135deg, var(--primary-500), var(--primary-600)); color: white; box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);"
      >
        <!-- Button glow -->
        <div
          id="btn-glow"
          class="absolute inset-0 rounded-lg opacity-0 transition-opacity duration-300"
          style="background: radial-gradient(circle, rgba(255,255,255,0.6), transparent); filter: blur(8px);"
        >
        </div>

        <svg
          xmlns="http://www.w3.org/2000/svg"
          fill="none"
          viewBox="0 0 24 24"
          stroke-width="2.5"
          stroke="currentColor"
          class="h-4 w-4 relative"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            d="M13.5 4.5L21 12m0 0l-7.5 7.5M21 12H3"></path>
        </svg>
      </button>
    </div>
  </div>

  <!-- Error message -->
  <p
    class="error-message hidden my-2 text-xs font-medium transition-colors"
    style="color: #ef4444;"
  >
  </p>

  <!-- Hint text -->
  <p
    class="hint-text my-2 text-xs font-medium transition-colors"
    style="color: var(--text-secondary);"
  >
     Ingresa tu c贸digo de ticket o PIN (m铆nimo 4 caracteres)
  </p>
</div>

<LoadingOverlay />

<style>
  input::placeholder {
    color: var(--text-secondary);
    opacity: 0.5;
  }

  input:focus::placeholder {
    opacity: 0.3;
    color: var(--primary-300);
  }

  #submit-btn {
    transition: all 300ms ease-in-out;
  }

  #submit-btn:disabled {
    opacity: 0.4 !important;
    cursor: not-allowed !important;
    pointer-events: none !important;
  }

  #submit-btn:not(:disabled):hover {
    transform: scale(1.1);
  }

  #submit-btn:not(:disabled):active {
    transform: scale(0.9);
  }

  @keyframes shimmer {
    0% {
      transform: translateX(-100%);
    }
    100% {
      transform: translateX(100%);
    }
  }

  @keyframes slideIn {
    from {
      transform: translateX(400px);
      opacity: 0;
    }
    to {
      transform: translateX(0);
      opacity: 1;
    }
  }

  @keyframes slideOut {
    from {
      transform: translateX(0);
      opacity: 1;
    }
    to {
      transform: translateX(400px);
      opacity: 0;
    }
  }

  /* Estilos para toast */
  :global(.bg-red-500) {
    background-color: rgb(239, 68, 68);
  }

  :global(.bg-green-500) {
    background-color: rgb(34, 197, 94);
  }

  :global(.bg-yellow-500) {
    background-color: rgb(234, 179, 8);
  }
</style>
